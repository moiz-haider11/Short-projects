<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Simple Calculator</title>
<style>
  :root{
    --bg:#0f1720; --card:#0b1220; --Accent:#3b82f6; --muted:#94a3b8; --btn:#111827;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  body{
    margin:0; min-height:100vh; display:grid; place-items:center; background:
    linear-gradient(180deg,#071126 0%, #071b12 100%);
    color:#e6eef8;
    padding:20px;
  }

  .calculator{
    width:360px; max-width:96vw;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:16px; padding:18px; box-shadow: 0 8px 40px rgba(2,6,23,0.7);
    border: 1px solid rgba(255,255,255,0.04);
  }

  .display{
    height:72px; border-radius:10px; padding:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    display:flex; flex-direction:column; justify-content:center; align-items:flex-end;
    gap:4px; margin-bottom:12px; position:relative;
  }

  .expr{
    font-size:14px; color:var(--muted); opacity:0.95; width:100%; text-align:right; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
  }
  .result{
    font-size:26px; font-weight:600; width:100%; text-align:right; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
  }

  .keys{
    display:grid; grid-template-columns: repeat(4,1fr); gap:10px;
  }

  button.key{
    font-size:18px; padding:14px; border-radius:10px; border:0; cursor:pointer; user-select:none;
    background:var(--glass); color:#e6eef8; box-shadow: 0 4px 12px rgba(2,6,23,0.35);
    transition:transform .06s ease, box-shadow .06s ease, background .08s;
  }
  button.key:active{ transform:translateY(1px) scale(.998); box-shadow: 0 2px 6px rgba(2,6,23,0.45); }

  /* styles for special keys */
  .key.op{ background: linear-gradient(180deg, rgba(59,130,246,0.18), rgba(59,130,246,0.12)); color:var(--Accent); font-weight:600; }
  .key.eq{ grid-column: span 2; background: linear-gradient(180deg,#2563eb,#1e40af); color:white; font-weight:700; }
  .key.ac{ background: linear-gradient(180deg, rgba(220,38,38,0.12), rgba(220,38,38,0.08)); color:#ffb4b4; }
  .key.wide{ grid-column: span 2; }

  /* responsive smaller */
  @media (max-width:380px){
    .display{ height:64px; }
    .result{ font-size:22px; }
    button.key{ padding:12px; font-size:16px; }
  }

  /* small accessible focus */
  button.key:focus{ outline: 3px solid rgba(59,130,246,0.25); outline-offset:2px; }
  .hint{ margin-top:10px; font-size:12px; color:var(--muted); text-align:center; }
</style>
</head>
<body>

<div class="calculator" role="application" aria-label="Simple Calculator">
  <div class="display" aria-live="polite">
    <div class="expr" id="expr"></div>
    <div class="result" id="result">0</div>
  </div>

  <div class="keys" id="keys">
    <button class="key ac" data-action="clear">AC</button>
    <button class="key" data-action="back">⌫</button>
    <button class="key" data-value="(">(</button>
    <button class="key" data-value=")" >)</button>

    <button class="key" data-value="7">7</button>
    <button class="key" data-value="8">8</button>
    <button class="key" data-value="9">9</button>
    <button class="key op" data-value="/">÷</button>

    <button class="key" data-value="4">4</button>
    <button class="key" data-value="5">5</button>
    <button class="key" data-value="6">6</button>
    <button class="key op" data-value="*">×</button>

    <button class="key" data-value="1">1</button>
    <button class="key" data-value="2">2</button>
    <button class="key" data-value="3">3</button>
    <button class="key op" data-value="-">−</button>

    <button class="key" data-value="0" class="wide">0</button>
    <button class="key" data-value="." >.</button>
    <button class="key op" data-value="+">+</button>

    <button class="key wide eq" data-action="equals">=</button>
  </div>

  <div class="hint">You can also use keyboard: numbers, + - * / ( ) Enter = Backspace Esc</div>
</div>

<script>
(() => {
  const exprEl = document.getElementById('expr');
  const resultEl = document.getElementById('result');
  const keys = document.getElementById('keys');

  let expression = '';     // string shown in exprEl
  let lastResult = null;   // store last computed result

  function render() {
    exprEl.textContent = expression || '\u00A0'; // keep height
    resultEl.textContent = (lastResult === null ? '0' : String(lastResult));
  }

  // safe-evaluate: allow only digits, operators, parentheses and decimal point
  function safeEvaluate(exp) {
    // Remove spaces
    exp = String(exp).trim();

    if (exp === '') return 0;
    // Basic validation: only allowed characters
    if (!/^[0-9+\-*/().\s]+$/.test(exp)) {
      throw new Error('Invalid characters in expression');
    }

    // Prevent sequences like "++" or "**" at start or other obvious bad forms
    if (/[\+\-*/]{2,}/.test(exp.replace(/\s+/g,''))) {
      // allow a leading - though (e.g. -5+3), so check more carefully:
      const cleaned = exp.replace(/\s+/g,'');
      if (!/^[-]?[0-9(]/.test(cleaned)) {
        throw new Error('Malformed expression');
      }
    }

    // Final eval using Function (local, no access to globals). This is fine for local calculator.
    // Wrap in parentheses to allow things like "(2+3)*4"
    /* eslint-disable no-new-func */
    const fn = new Function('return (' + exp + ')');
    const val = fn();
    if (typeof val !== 'number' || !isFinite(val)) throw new Error('Result is not a finite number');
    return val;
  }

  function pushValue(val) {
    // if last action was "equals" and user starts typing a number, replace expression
    // but if they press operator after equals, continue from last result
    const isDigitOrDot = /^[0-9.]$/.test(val);
    if (lastResult !== null && expression === '' && isDigitOrDot) {
      lastResult = null;
    }
    expression += val;
    render();
  }

  function clearAll() {
    expression = '';
    lastResult = null;
    render();
  }

  function backspace() {
    if (expression.length > 0) {
      expression = expression.slice(0, -1);
    } else {
      lastResult = null;
    }
    render();
  }

  function compute() {
    try {
      const value = safeEvaluate(expression || String(lastResult || 0));
      lastResult = Math.round((value + Number.EPSILON) * 1000000000) / 1000000000; // trim floating noise
      expression = ''; // start fresh; user can continue with operator if they want
      render();
    } catch (err) {
      // show brief error in result
      resultEl.textContent = 'Error';
      setTimeout(() => {
        resultEl.textContent = (lastResult === null ? '0' : String(lastResult));
      }, 800);
    }
  }

  // Click handling (delegation)
  keys.addEventListener('click', (e) => {
    const btn = e.target.closest('button');
    if (!btn) return;
    const val = btn.getAttribute('data-value');
    const action = btn.getAttribute('data-action');

    if (action === 'clear') { clearAll(); return; }
    if (action === 'back') { backspace(); return; }
    if (action === 'equals') { compute(); return; }

    if (val) {
      pushValue(val);
    }
  });

  // Keyboard support
  window.addEventListener('keydown', (e) => {
    const key = e.key;
    if (/^[0-9]$/.test(key)) { pushValue(key); e.preventDefault(); return; }
    if (key === '.') { pushValue('.'); e.preventDefault(); return; }
    if (key === '+' || key === '-' || key === '*' || key === '/') { pushValue(key); e.preventDefault(); return; }
    if (key === 'Enter' || key === '=') { compute(); e.preventDefault(); return; }
    if (key === 'Backspace') { backspace(); e.preventDefault(); return; }
    if (key === 'Escape') { clearAll(); e.preventDefault(); return; }
    if (key === '(' || key === ')') { pushValue(key); e.preventDefault(); return; }
  });

  // initial render
  render();
})();
</script>
</body>
</html>
